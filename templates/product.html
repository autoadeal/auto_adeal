<invoke name="artifacts">
<parameter name="command">create</parameter>
<parameter name="type">application/vnd.ant.code</parameter>
<parameter name="language">html</parameter>
<parameter name="title">product.html</parameter>
<parameter name="id">product_html</parameter>
<parameter name="content"><!doctype html>
<html lang="sq" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- SEO Meta Tags - Dynamic from backend -->
  <title>{{ product.product_name }} - Auto Adeal | Çmimi {{ (product.discount_price or product.price)|int }} ALL</title>
  <meta name="description" content="Blej {{ product.product_name }} online. {{ product.description or '' }} Cmimi: {{ (product.discount_price or product.price)|int }} ALL. Dergesa ne Shqiperi dhe Kosove.">
  <meta name="keywords" content="auto adeal, {{ product.product_name }}, pjese makine, aksesore auto, {{ product.subcategory.subcategory_name }}">
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/static/favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32.png">
  <!-- Open Graph -->
  <meta property="og:type" content="product">
  <meta property="og:title" content="{{ product.product_name }} - Auto Adeal">
  <meta property="og:description" content="{{ product.description or product.product_name }}">
  <meta property="og:image" content="https://autoadeal.com{{ product.main_image or '/static/logo.png' }}">
  <meta property="og:url" content="https://autoadeal.com/product/{{ product.product_id }}">
  <meta property="product:price:amount" content="{{ product.discount_price or product.price }}">
  <meta property="product:price:currency" content="ALL">
  <link rel="canonical" href="https://autoadeal.com/product/{{ product.product_id }}">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-E15BNGDX8F"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-E15BNGDX8F');
  </script>
  <style>
    /* Prevent zoom on input focus for mobile */
    @media (max-width: 767px) {
      input[type="text"],
      input[type="email"],
      input[type="password"],
      select {
        font-size: 16px !important;
      }
    }
    
    .thumbnail-active {
      border-color: #dc2626 !important;
    }
  </style>
  <!-- Breadcrumb Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://autoadeal.com"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "{{ product.subcategory.category.category_name }}",
        "item": "https://autoadeal.com"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "{{ product.subcategory.subcategory_name }}",
        "item": "https://autoadeal.com/subcategory/{{ product.subcategory.subcategory_id }}"
      },
      {
        "@type": "ListItem",
        "position": 4,
        "name": "{{ product.product_name }}",
        "item": "https://autoadeal.com/product/{{ product.product_id }}"
      }
    ]
  }
  </script>
  <!-- Product Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": "{{ product.product_name }}",
    "image": "https://autoadeal.com{{ product.main_image or '/static/logo.png' }}",
    "description": "{{ product.description or product.product_name }}",
    "sku": "PROD-{{ product.product_id }}",
    "brand": {
      "@type": "Brand",
      "name": "Auto Adeal"
    },
    "offers": {
      "@type": "Offer",
      "url": "https://autoadeal.com/product/{{ product.product_id }}",
      "priceCurrency": "ALL",
      "price": "{{ product.discount_price or product.price }}",
      "availability": "{% if product.sold_out %}https://schema.org/OutOfStock{% else %}https://schema.org/InStock{% endif %}",
      "seller": {
        "@type": "Organization",
        "name": "Auto Adeal"
      }
    }
  }
  </script>
</head>
<body class="h-full bg-white">
  <!-- COPY HEADER from subcategory.html - START -->
  <header class="bg-black text-white py-3 md:py-4">
    <div class="container mx-auto px-4 md:px-6">
      <!-- Mobile Layout -->
      <div class="md:hidden">
        <div class="flex items-center justify-between mb-3">
          <button id="mobile-menu-btn" onclick="toggleMobileMenu()" class="text-white mr-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        <a href="/" class="flex items-center flex-1 h-8 hover:opacity-80 transition-opacity">
          <img id="site-logo-mobile" src="/static/logo.png" alt="Logo" class="h-full w-auto object-contain">
        </a>
      
      <div class="flex items-center space-x-4">
        <button onclick="window.location.href='/wishlist'" class="relative">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
          <span id="wishlist-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
        </button>
        
        <button onclick="window.location.href='/cart'" class="relative">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
          </svg>
          <span id="cart-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
        </button>
      </div>
    </div>
    
    <div class="flex">
      <input type="text" id="search-input-mobile" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none text-sm">
      <button onclick="performSearch()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-r-full transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>
    </div>
  </div>
  
  <!-- Desktop Layout -->
  <div class="hidden md:flex items-center justify-between">
    <div class="flex items-center ml-8">
      <a href="/" class="flex items-center hover:opacity-80 transition-opacity">
        <img id="site-logo" src="/static/logo.png" alt="Logo" class="h-12 md:h-14 w-auto max-w-[250px] object-contain">
      </a>
    </div>
    
    <div class="flex-1 max-w-md mx-8">
      <div class="flex">
        <input type="text" id="search-input" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none">
        <button onclick="performSearch()" class="bg-red-600 hover:bg-red-700 pl-6 pr-7 py-2 rounded-r-full transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <div class="flex items-center space-x-6">
      <button onclick="window.location.href='/wishlist'" class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
        <span id="wishlist-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
      </button>
      
      <button onclick="window.location.href='/cart'" class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
        </svg>
        <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
      </button>
    </div>
  </div>
</div>

</header>
  <!-- COPY HEADER - END -->
  <!-- Navigation Bar -->
  <nav class="bg-white border-b border-gray-200 py-4">
    <div class="container mx-auto px-4 md:px-6">
      <div class="flex justify-center space-x-6 md:space-x-24">
        <a href="/" class="text-black hover:text-red-600 font-medium transition-colors">Kryefaqja</a>
        <a href="/special-offers" class="text-black hover:text-red-600 font-medium transition-colors">Oferta</a>
        <a href="/brands" class="text-black hover:text-red-600 font-medium transition-colors">Marka</a>
        <a href="/contact" class="text-black hover:text-red-600 font-medium transition-colors">Na Kontaktoni</a>
      </div>
    </div>
  </nav>
  <!-- Main Content -->
  <main class="container mx-auto px-4 md:px-6 py-6">
    <a href="/subcategory/{{ product.subcategory.subcategory_id }}/{{ product.subcategory.subcategory_name|urlencode }}" 
       class="text-red-600 hover:text-red-700 mb-4 inline-block font-medium">
      ← Kthehu te {{ product.subcategory.subcategory_name }}
    </a> 
    <!-- Mobile: Title First -->
<h1 class="text-xl font-bold text-black mb-4 lg:hidden">{{ product.product_name }}</h1>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-12 mb-8 md:mb-12">
  <!-- Left: Images -->
  <div class="flex items-center justify-center">
    <div class="flex flex-col lg:flex-row items-center lg:items-start gap-4 max-w-[600px]">
      <!-- Desktop: Thumbnails on left -->
      {% if images|length > 0 %}
      <div class="hidden lg:flex lg:flex-col gap-3" id="desktop-thumbnails">
        {% for img in images[:4] %}
        <div class="flex-shrink-0 aspect-square w-[112px] h-[112px] border-2 border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-red-600 transition-colors bg-white thumbnail"
             onclick="changeMainImage('{{ img }}')" 
             style="min-width: 112px; min-height: 112px;">
          <img src="{{ img }}" alt="{{ product.product_name }} - Foto {{ loop.index }}" class="w-full h-full object-contain p-2" loading="lazy">
        </div>
        {% endfor %}
      </div>
      {% endif %}
      
      <div class="flex flex-col items-center gap-4 w-full">
        <!-- Main image -->
        <div class="aspect-square w-full max-w-[90vw] lg:w-[484px] lg:h-[484px] bg-white rounded-xl overflow-hidden flex items-center justify-center border border-gray-200 p-4 relative" style="min-height: 350px;">
          <img id="main-product-image" 
               src="{{ product.main_image or '/static/uploads/default.png' }}" 
               alt="{{ product.product_name }} - Blerje Online Auto Adeal Shqiperi" 
               class="w-full h-full object-contain {% if product.sold_out %}grayscale opacity-50{% endif %}" 
               style="min-height: 300px;" 
               loading="eager">
          {% if product.sold_out %}
          <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-20">
            <span class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg">SOLD OUT</span>
          </div>
          {% endif %}
        </div>
        
        <!-- Mobile: Thumbnails below -->
        {% if images|length > 0 %}
        <div class="grid grid-cols-4 gap-2 w-full max-w-[90vw] lg:hidden" id="mobile-thumbnails">
          {% for img in images[:4] %}
          <div class="aspect-square border-2 border-gray-200 rounded-lg overflow-hidden cursor-pointer hover:border-red-600 transition-colors bg-white thumbnail"
               onclick="changeMainImage('{{ img }}')"
               style="min-height: 80px;">
            <img src="{{ img }}" class="w-full h-full object-contain p-1" loading="lazy">
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Right: Product details -->
  <div>
    <h1 class="hidden lg:block text-3xl font-bold text-black mb-4">{{ product.product_name }}</h1>
    
    <div class="mb-6">
      {% if product.discount_price and product.discount_price < product.price %}
      <div class="flex items-center space-x-3">
        <p class="text-red-700 font-bold text-3xl">{{ product.discount_price|int }} ALL</p>
        <p class="text-gray-500 line-through text-xl">{{ product.price|int }} ALL</p>
      </div>
      {% else %}
      <p class="text-red-700 font-bold text-3xl">{{ product.price|int }} ALL</p>
      {% endif %}
    </div>
    
    <div class="mb-6">
      <h3 class="font-bold text-lg mb-2 text-black">Përshkrimi</h3>
      <p class="text-gray-700 leading-relaxed">{{ product.description or 'Nuk ka përshkrim të disponueshëm.' }}</p>
    </div>
    
    {% if specs|length > 0 %}
    <div class="mb-6">
      <h3 class="font-bold text-lg mb-3 text-black">Specifikimet</h3>
      <div class="grid grid-cols-2 gap-3">
        {% for key, value in specs.items() %}
        <div class="bg-gray-50 p-3 rounded-lg">
          <p class="text-xs text-gray-600 mb-1">{{ key }}</p>
          <p class="text-sm font-semibold text-black">{{ value }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
    <div class="flex space-x-4 mt-8">
      {% if product.sold_out %}
      <div class="flex-1 bg-gray-400 text-white px-6 py-4 rounded-lg text-center font-bold text-lg cursor-not-allowed">
        SOLD OUT - Not Available
      </div>
      {% else %}
      <button onclick="toggleWishlist({{ product.product_id }}, '{{ product.product_name|replace("'", "\\'") }}', {{ product.price }}, '{{ product.main_image }}')" 
              class="border-2 border-red-600 text-red-600 px-6 py-3 rounded-lg hover:bg-red-50 transition-colors flex items-center space-x-2 font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
        <span>Dëshirat</span>
      </button>
      <button onclick="addToCart({{ product.product_id }}, '{{ product.product_name|replace("'", "\\'") }}', {{ product.discount_price or product.price }}, '{{ product.main_image }}')" 
              class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center space-x-2 font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
        </svg>
        <span>Shto në Shportë</span>
      </button>
      {% endif %}
    </div>
  </div>
</div>

<!-- Related Products -->
{% if related|length > 0 %}
<div class="mt-16">
  <h3 class="text-2xl font-bold text-black mb-6">Produkte të Ngjashme</h3>
  <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
    {% for r in related %}
    <a href="/product/{{ r.product_id }}" class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow bg-white block">
      <div class="aspect-square bg-white rounded-lg overflow-hidden mb-3">
        <img src="{{ r.main_image or '/static/uploads/default.png' }}" class="w-full h-full object-contain">
      </div>
      <h4 class="font-semibold text-black mb-2 text-sm text-center line-clamp-2">{{ r.product_name }}</h4>
      <div class="text-center">
        {% if r.discount_price and r.discount_price < r.price %}
        <div class="flex items-center justify-center space-x-2">
          <p class="text-red-700 font-semibold text-sm">{{ r.discount_price|int }} ALL</p>
          <p class="text-xs text-gray-500 line-through">{{ r.price|int }} ALL</p>
        </div>
        {% else %}
        <p class="text-red-700 font-semibold">{{ r.price|int }} ALL</p>
        {% endif %}
      </div>
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}

</main>
  <!-- COPY FOOTER from subcategory.html -->
  <footer class="bg-black text-white py-8 md:py-12 mt-auto">
    <div class="container mx-auto px-4 md:px-6 max-w-7xl">
      <div class="text-center">
        <p class="text-xs text-gray-400">&copy; 2025 Auto Adeal. Të gjitha të drejtat e rezervuara.</p>
      </div>
    </div>
  </footer>
  <!-- JavaScript -->
  <script>
    // Cart and Wishlist functionality
    let cartItems = JSON.parse(localStorage.getItem('auto_adeal_cart') || '[]');
    let wishlistItems = JSON.parse(localStorage.getItem('auto_adeal_wishlist') || '[]');
    
    function updateCartCount() {
      document.getElementById('cart-count').textContent = cartItems.length;
      document.getElementById('cart-count-mobile').textContent = cartItems.length;
    }
    
    function updateWishlistCount() {
      document.getElementById('wishlist-count').textContent = wishlistItems.length;
      document.getElementById('wishlist-count-mobile').textContent = wishlistItems.length;
    }
    
    function addToCart(productId, productName, productPrice, productImage) {
      const existingItem = cartItems.find(item => item.productId === productId);
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cartItems.push({ productId, productName, productPrice, productImage, quantity: 1 });
      }
      localStorage.setItem('auto_adeal_cart', JSON.stringify(cartItems));
      updateCartCount();
      showNotification('U shtua në Shportë!', 'success');
    }
    
    function toggleWishlist(productId, productName, productPrice, productImage) {
      const existingIndex = wishlistItems.findIndex(item => item.productId === productId);
      if (existingIndex !== -1) {
        wishlistItems.splice(existingIndex, 1);
        showNotification('U hoq nga Lista', 'success');
      } else {
        wishlistItems.push({ productId, productName, productPrice, productImage });
        showNotification('U shtua në Listë!', 'success');
      }
      localStorage.setItem('auto_adeal_wishlist', JSON.stringify(wishlistItems));
      updateWishlistCount();
    }
    
    function changeMainImage(newSrc) {
      const mainImg = document.getElementById('main-product-image');
      if (mainImg) {
        mainImg.src = newSrc;
      }
      
      // Update active thumbnail
      document.querySelectorAll('.thumbnail').forEach(thumb => {
        thumb.classList.remove('thumbnail-active');
      });
      event.currentTarget.classList.add('thumbnail-active');
    }
    
    function showNotification(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
    
    function performSearch() {
      const query = document.getElementById('search-input').value.trim();
      if (query) {
        window.location.href = '/search?q=' + encodeURIComponent(query);
      }
    }
    
    // Initialize counts
    updateCartCount();
    updateWishlistCount();
  </script>
</body>
</html>
</parameter>
</invoke>