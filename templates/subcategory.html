<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{{ subcategory.subcategory_name }} - Auto Adeal</title>
    <meta name="description" content="Gjej {{ subcategory.subcategory_name }} për makinën tënde. Cilësi e lartë, çmime konkurruese.">
    
    <link rel="icon" type="image/x-icon" href="/static/favicon/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @media (max-width: 767px) {
            input[type="text"],
            input[type="email"],
            input[type="password"],
            select,
            textarea {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body class="bg-white">
    <!-- Header (same as refund_policy.html) -->
    <header class="bg-black text-white py-3 md:py-4">
        <div class="container mx-auto px-4 md:px-6">
            <!-- Mobile Layout -->
            <div class="md:hidden">
                <div class="flex items-center justify-between mb-3">
                    <button onclick="window.location.href='/'" class="text-white mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                    
                    <a href="/" class="flex items-center flex-1 h-8">
                        <img src="/static/logo.png" alt="Logo" class="h-full w-auto object-contain">
                    </a>
                    
                    <div class="flex items-center space-x-4">
                        <a href="/" class="flex items-center text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </a>
                        
                        <a href="/wishlist" class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                            <span id="wishlist-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                        </a>
                        
                        <a href="/cart" class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
                            </svg>
                            <span id="cart-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                        </a>
                    </div>
                </div>
                
                <div class="flex">
                    <input type="text" id="search-input-mobile" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none text-sm">
                    <button onclick="performSearch()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-r-full transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Desktop Layout -->
            <div class="hidden md:flex items-center justify-between">
                <div class="flex items-center ml-8">
                    <a href="/" class="flex items-center hover:opacity-80 transition-opacity">
                        <img src="/static/logo.png" alt="Logo" class="h-12 md:h-14 w-auto max-w-[250px] object-contain">
                    </a>
                </div>
                
                <div class="flex-1 max-w-md mx-8">
                    <div class="flex">
                        <input type="text" id="search-input" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none">
                        <button onclick="performSearch()" class="bg-red-600 hover:bg-red-700 pl-6 pr-7 py-2 rounded-r-full transition-colors flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center space-x-6">
                    <a href="/" class="flex items-center space-x-2 text-white hover:text-red-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        <span>Llogaria</span>
                    </a>
                    
                    <a href="/wishlist" class="relative hover:text-red-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                        <span id="wishlist-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                    </a>
                    
                    <a href="/cart" class="relative hover:text-red-500 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
                        </svg>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 py-4">
        <div class="container mx-auto px-4 md:px-6">
            <div class="flex justify-center space-x-6 md:space-x-24 overflow-x-auto">
                <a href="/" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Kryefaqja</a>
                <a href="/special-offers" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Oferta</a>
                <a href="/brands" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Marka</a>
                <a href="/contact" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Na Kontaktoni</a>
            </div>
        </div>
    </nav>

    <!-- Mobile Filters Toggle -->
    <div class="md:hidden bg-white border-b border-gray-200">
        <button id="mobile-filters-toggle" onclick="toggleMobileFilters()" class="w-full px-4 py-3 flex items-center justify-between text-left">
            <span class="font-semibold text-black flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                </svg>
                Filtrat
            </span>
            <svg id="mobile-filters-arrow" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        
        <div id="mobile-filters-panel" class="hidden px-4 pb-4">
            <div id="mobile-dynamic-filters" class="space-y-4">
                <!-- Price Filter -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">Çmimi (ALL)</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-gray-600 mb-1 block">Nga:</label>
                            <input type="number" id="mobile-min-price" value="0" min="0" max="20000" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-black text-sm">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 mb-1 block">Deri:</label>
                            <input type="number" id="mobile-max-price" value="20000" min="0" max="20000" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-black text-sm">
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Filters -->
                {% for spec in spec_types %}
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">{{ spec.name }}</label>
                    {% if spec.choices %}
                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg text-black text-sm" data-spec-id="{{ spec.id }}">
                            <option value="">Zgjidh</option>
                            {% for choice in spec.choices %}
                            <option value="{{ choice }}">{{ choice }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-black text-sm" data-spec-id="{{ spec.id }}" placeholder="Kërko {{ spec.name }}">
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <button onclick="applyMobileFilters()" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors mt-4 font-medium">
                Apliko Filtrat
            </button>
        </div>
    </div>

    <!-- Main Content with Sidebar -->
    <div class="md:flex min-h-screen">
        <!-- Desktop Sidebar with Filters -->
        <aside class="hidden md:block md:w-64 bg-gray-50 p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-lg text-black">Filtrat</h3>
                <a href="/" class="text-red-600 hover:text-red-700 text-sm">← Kryefaqja</a>
            </div>
            
            <div id="desktop-filters" class="space-y-4">
                <!-- Price Range Filter -->
                <div class="mb-6 pb-4 border-b border-gray-200">
                    <label class="block text-sm font-medium text-black mb-3">Çmimi (ALL)</label>
                    
                    <div class="relative h-2 bg-gray-200 rounded-full mb-4" id="price-slider">
                        <div id="price-track" class="absolute h-2 bg-red-600 rounded-full"></div>
                        <div id="min-thumb" class="absolute w-5 h-5 bg-red-600 border-2 border-white rounded-full cursor-pointer shadow-md" style="top: -6px;"></div>
                        <div id="max-thumb" class="absolute w-5 h-5 bg-red-600 border-2 border-white rounded-full cursor-pointer shadow-md" style="top: -6px;"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-gray-600 mb-1 block">Nga:</label>
                            <input type="number" id="min-price-input" value="0" min="0" max="20000" class="w-full px-3 py-2 border border-gray-300 rounded text-black text-sm">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 mb-1 block">Deri:</label>
                            <input type="number" id="max-price-input" value="20000" min="0" max="20000" class="w-full px-3 py-2 border border-gray-300 rounded text-black text-sm">
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Spec Filters -->
                {% for spec in spec_types %}
                <div class="mb-4">
                    <label class="block text-sm font-medium text-black mb-2">{{ spec.name }}</label>
                    {% if spec.choices %}
                        <select id="filter-{{ spec.id }}" class="w-full px-3 py-2 border border-gray-300 rounded text-black text-sm">
                            <option value="">Zgjidh</option>
                            {% for choice in spec.choices %}
                            <option value="{{ choice }}">{{ choice }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <input type="text" id="filter-{{ spec.id }}" placeholder="Kërko {{ spec.name }}" class="w-full px-3 py-2 border border-gray-300 rounded text-black text-sm">
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            
            <button onclick="applyDesktopFilters()" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors mt-4">
                Apliko Filtrat
            </button>
        </aside>

        <!-- Products Grid -->
        <main class="flex-1 p-4 md:p-6">
            <h1 class="text-2xl md:text-3xl font-bold text-black mb-6">{{ subcategory.subcategory_name }}</h1>
            
            <div id="products-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                {% for product in products %}
                <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow" data-product-id="{{ product.product_id }}">
                    <a href="/product/{{ product.product_name.lower().replace(' ', '-') }}-{{ product.product_id }}" class="block">
                        <div class="aspect-square mb-3 flex items-center justify-center bg-white rounded-lg overflow-hidden">
                            <img src="{{ product.main_image }}" alt="{{ product.product_name }}" class="w-full h-full object-contain p-2" loading="lazy">
                        </div>
                        <h4 class="font-semibold text-black mb-2 text-center text-sm md:text-base min-h-[40px] md:min-h-[24px] line-clamp-2 md:line-clamp-1">{{ product.product_name }}</h4>
                        <div class="mt-auto">
                            {% if product.discount_price and product.discount_price < product.price %}
                            <div class="flex items-center justify-center space-x-2">
                                <p class="text-red-700 font-bold text-base md:text-lg">{{ product.discount_price|round|int }} ALL</p>
                                <p class="text-xs md:text-sm text-gray-500 line-through">{{ product.price|round|int }} ALL</p>
                            </div>
                            {% else %}
                            <p class="text-red-700 font-bold text-base md:text-lg text-center">{{ product.price|round|int }} ALL</p>
                            {% endif %}
                        </div>
                    </a>
                    
                    <div class="flex gap-2 mt-3">
                        <button onclick="toggleWishlist({{ product.product_id }}, '{{ product.product_name }}', {{ product.discount_price or product.price }}, '{{ product.main_image }}')" class="bg-gray-200 text-black py-2 px-2.5 rounded hover:bg-red-700 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                        
                        <button onclick="addToCart({{ product.product_id }}, '{{ product.product_name }}', {{ product.discount_price or product.price }}, '{{ product.main_image }}')" class="flex-1 bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors text-xs md:text-sm">
                            Shto në Shportë
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <!-- Footer (same as refund_policy.html) -->
    <footer class="bg-black text-white py-8 md:py-12 mt-auto">
        <div class="container mx-auto px-4 md:px-6 max-w-7xl">
            <div class="hidden md:flex flex-col items-center justify-center gap-8">
                <div class="flex-shrink-0">
                    <img src="/static/logo.png" alt="Auto Adeal" class="h-20 w-auto" onerror="this.style.display='none'">
                </div>
                
                <div class="grid grid-cols-3 gap-x-16 gap-y-4 text-center text-sm">
                    <div class="space-y-3">
                        <a href="/privacy-policy" class="block hover:text-red-400 transition-colors">Privacy Policy</a>
                        <a href="/terms-conditions" class="block hover:text-red-400 transition-colors">Terms & Conditions</a>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="/blog" class="block hover:text-red-400 transition-colors">Blog</a>
                        <a href="/refund-policy" class="block hover:text-red-400 transition-colors">Refund & Shipping</a>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="/about" class="block hover:text-red-400 transition-colors">About Us</a>
                        <a href="/contact" class="block hover:text-red-400 transition-colors">Contact Us</a>
                    </div>
                </div>
            </div>

            <div class="md:hidden">
                <div class="grid grid-cols-2 gap-x-8 gap-y-3 text-center text-sm">
                    <a href="/privacy-policy" class="hover:text-red-400 transition-colors">Privacy Policy</a>
                    <a href="/terms-conditions" class="hover:text-red-400 transition-colors">Terms & Conditions</a>
                    <a href="/blog" class="hover:text-red-400 transition-colors">Blog</a>
                    <a href="/refund-policy" class="hover:text-red-400 transition-colors">Refund & Shipping</a>
                    <a href="/about" class="hover:text-red-400 transition-colors">About Us</a>
                    <a href="/contact" class="hover:text-red-400 transition-colors">Contact Us</a>
                </div>
            </div>

            <div class="text-center mt-8 pt-4 border-t border-gray-700 text-xs text-gray-400">
            <p>&copy; 2025 Auto Adeal. Të gjitha të drejtat e rezervuara.</p>
        </div>
    </div>
</footer>

<script>
    // Cart and Wishlist Management
    let cartItems = [];
    let wishlistItems = [];

    function loadCartFromStorage() {
        try {
            const stored = localStorage.getItem('auto_adeal_cart');
            if (stored) {
                cartItems = JSON.parse(stored);
            }
        } catch (e) {
            console.error('Error loading cart:', e);
            cartItems = [];
        }
    }

    function saveCartToStorage() {
        localStorage.setItem('auto_adeal_cart', JSON.stringify(cartItems));
    }

    function loadWishlistFromStorage() {
        try {
            const stored = localStorage.getItem('auto_adeal_wishlist');
            if (stored) {
                wishlistItems = JSON.parse(stored);
            }
        } catch (e) {
            console.error('Error loading wishlist:', e);
            wishlistItems = [];
        }
    }

    function saveWishlistToStorage() {
        localStorage.setItem('auto_adeal_wishlist', JSON.stringify(wishlistItems));
    }

    function updateCartCount() {
        const count = cartItems.length;
        document.getElementById('cart-count').textContent = count;
        const mobileCount = document.getElementById('cart-count-mobile');
        if (mobileCount) mobileCount.textContent = count;
    }

    function updateWishlistCount() {
        const count = wishlistItems.length;
        document.getElementById('wishlist-count').textContent = count;
        const mobileCount = document.getElementById('wishlist-count-mobile');
        if (mobileCount) mobileCount.textContent = count;
    }

    function addToCart(productId, productName, productPrice, productImage) {
        const existingItem = cartItems.find(item => item.productId === productId);
        
        if (existingItem) {
            existingItem.quantity += 1;
            showNotification('Sasia u ndryshua në shportë', 'success');
        } else {
            cartItems.push({
                productId,
                productName,
                productPrice,
                productImage,
                quantity: 1
            });
            showNotification('U shtua në shportë!', 'success');
        }
        
        saveCartToStorage();
        updateCartCount();
    }

    function toggleWishlist(productId, productName, productPrice, productImage) {
        const existingIndex = wishlistItems.findIndex(item => item.productId === productId);
        
        if (existingIndex !== -1) {
            wishlistItems.splice(existingIndex, 1);
            showNotification('U hoq nga lista', 'success');
        } else {
            wishlistItems.push({
                productId,
                productName,
                productPrice,
                productImage
            });
            showNotification('U shtua në listë!', 'success');
        }
        
        saveWishlistToStorage();
        updateWishlistCount();
    }

    function showNotification(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // Mobile Filters Toggle
    function toggleMobileFilters() {
        const panel = document.getElementById('mobile-filters-panel');
        const arrow = document.getElementById('mobile-filters-arrow');
        
        panel.classList.toggle('hidden');
        arrow.classList.toggle('rotate-180');
    }

    // Desktop Price Slider
    function initializePriceSlider() {
        const slider = document.getElementById('price-slider');
        const track = document.getElementById('price-track');
        const minThumb = document.getElementById('min-thumb');
        const maxThumb = document.getElementById('max-thumb');
        const minInput = document.getElementById('min-price-input');
        const maxInput = document.getElementById('max-price-input');
        
        if (!slider || !track || !minThumb || !maxThumb) return;
        
        let priceRange = { min: 0, max: 20000 };
        let isDragging = false;
        let activeThumb = null;
        
        function updateSlider() {
            const sliderWidth = slider.offsetWidth;
            const minPercent = (priceRange.min / 20000) * 100;
            const maxPercent = (priceRange.max / 20000) * 100;
            
            minThumb.style.left = `calc(${minPercent}% - 10px)`;
            maxThumb.style.left = `calc(${maxPercent}% - 10px)`;
            
            track.style.left = `${minPercent}%`;
            track.style.width = `${maxPercent - minPercent}%`;
            
            minInput.value = priceRange.min;
            maxInput.value = priceRange.max;
        }
        
        function handleMouseDown(e, thumb) {
            isDragging = true;
            activeThumb = thumb;
            e.preventDefault();
        }
        
        function handleMouseMove(e) {
            if (!isDragging || !activeThumb) return;
            
            const rect = slider.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
            const value = Math.round((percent / 100) * 20000);
            
            if (activeThumb === minThumb) {
                priceRange.min = Math.min(value, priceRange.max - 100);
            } else {
                priceRange.max = Math.max(value, priceRange.min + 100);
            }
            
            updateSlider();
        }
        
        function handleMouseUp() {
            isDragging = false;
            activeThumb = null;
        }
        
        minThumb.addEventListener('mousedown', (e) => handleMouseDown(e, minThumb));
        maxThumb.addEventListener('mousedown', (e) => handleMouseDown(e, maxThumb));
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
        
        minInput.addEventListener('input', (e) => {
            const value = parseInt(e.target.value) || 0;
            priceRange.min = Math.max(0, Math.min(value, priceRange.max - 100));
            updateSlider();
        });
        
        maxInput.addEventListener('input', (e) => {
            const value = parseInt(e.target.value) || 20000;
            priceRange.max = Math.min(20000, Math.max(value, priceRange.min + 100));
            updateSlider();
        });
        
        updateSlider();
    }

    // Apply Desktop Filters
    function applyDesktopFilters() {
        const minPrice = parseInt(document.getElementById('min-price-input').value) || 0;
        const maxPrice = parseInt(document.getElementById('max-price-input').value) || 20000;
        
        const filters = {};
        {% for spec in spec_types %}
        const filter{{ spec.id }} = document.getElementById('filter-{{ spec.id }}');
        if (filter{{ spec.id }} && filter{{ spec.id }}.value) {
            filters['{{ spec.id }}'] = filter{{ spec.id }}.value.toLowerCase();
        }
        {% endfor %}
        
        filterProducts(minPrice, maxPrice, filters);
    }

    // Apply Mobile Filters
    function applyMobileFilters() {
        const minPrice = parseInt(document.getElementById('mobile-min-price').value) || 0;
        const maxPrice = parseInt(document.getElementById('mobile-max-price').value) || 20000;
        
        const filters = {};
        document.querySelectorAll('#mobile-dynamic-filters [data-spec-id]').forEach(input => {
            if (input.value) {
                filters[input.dataset.specId] = input.value.toLowerCase();
            }
        });
        
        filterProducts(minPrice, maxPrice, filters);
        
        // Close mobile filters panel
        document.getElementById('mobile-filters-panel').classList.add('hidden');
        document.getElementById('mobile-filters-arrow').classList.remove('rotate-180');
    }

    // Filter Products
    function filterProducts(minPrice, maxPrice, filters) {
        const products = document.querySelectorAll('#products-container > div');
        let visibleCount = 0;
        
        products.forEach(product => {
            const productId = product.dataset.productId;
            
            // Get product price
            const priceText = product.querySelector('.text-red-700').textContent;
            const price = parseInt(priceText.replace(/[^0-9]/g, ''));
            
            // Check price range
            if (price < minPrice || price > maxPrice) {
                product.style.display = 'none';
                return;
            }
            
            // Check spec filters (you'll need to add data attributes to products)
            // For now, just show all products that pass price filter
            product.style.display = 'block';
            visibleCount++;
        });
        
        showNotification(`${visibleCount} produkte u gjeten`, 'success');
    }

    // Search Functionality
    function performSearch() {
        const query = document.getElementById('search-input').value || document.getElementById('search-input-mobile').value;
        if (query.trim()) {
            window.location.href = `/search?q=${encodeURIComponent(query)}`;
        }
    }

    // Enter key support
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-input');
        const searchInputMobile = document.getElementById('search-input-mobile');
        
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        }
        
        if (searchInputMobile) {
            searchInputMobile.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        }
        
        // Initialize
        loadCartFromStorage();
        loadWishlistFromStorage();
        updateCartCount();
        updateWishlistCount();
        initializePriceSlider();
    });
</script>
</body>
</html>