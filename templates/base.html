<!doctype html>
<html lang="en" class="h-full">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E15BNGDX8F"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-E15BNGDX8F');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Preload critical resources -->
<link rel="preconnect" href="https://cdn.tailwindcss.com">
<link rel="dns-prefetch" href="https://cdn.tailwindcss.com">

<!-- SEO Meta Tags -->
<title>{% block title %}Auto Adeal - Aksesore dhe Pjese per Makina ne Shqiperi{% endblock %}</title>

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/static/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="/static/favicon/favicon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/static/favicon/favicon-512.png">

<meta name="description" content="{% block description %}Blej pjese dhe aksesore per makina online ne Shqiperi dhe Kosove. Cilesi e larte, Cmime te uleta, dergese e shpejte.{% endblock %}">
<meta name="keywords" content="{% block keywords %}auto adeal, pjese, makine, aksesore, auto, parts, shqiperi{% endblock %}">
<meta name="author" content="Auto Adeal">
<meta name="robots" content="index, follow">
<link rel="canonical" href="{% block canonical %}https://autoadeal.com{% endblock %}">

<!-- Language -->
<meta http-equiv="content-language" content="sq-AL">

<!-- Open Graph (Facebook/Instagram) -->
<meta property="og:type" content="website">
<meta property="og:title" content="{% block og_title %}Auto Adeal - Pjese per Makina Shqiperi{% endblock %}">
<meta property="og:description" content="{% block og_description %}Blej pjese dhe aksesore per makina me cilesi te larte dhe cmime te uleta.{% endblock %}">
<meta property="og:image" content="{% block og_image %}https://autoadeal.com/static/logo.png{% endblock %}">
<meta property="og:url" content="{% block og_url %}https://autoadeal.com{% endblock %}">
<meta property="og:site_name" content="Auto Adeal">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{% block twitter_title %}Auto Adeal - Pjese per Makina Shqiperi{% endblock %}">
<meta name="twitter:description" content="{% block twitter_description %}Blej pjese dhe aksesore per makina me cilesi te larte dhe cmime te uleta.{% endblock %}">
<meta name="twitter:image" content="{% block twitter_image %}https://autoadeal.com/static/logo.png{% endblock %}">

<style>   
#scroll-to-top-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: #dc2626;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    z-index: 999999 !important;
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transform: scale(0.8);
    transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
    pointer-events: none;
}

#scroll-to-top-btn.visible {
    opacity: 1;
    visibility: visible;
    transform: scale(1);
    pointer-events: auto;
}

#scroll-to-top-btn:hover {
    background: #b91c1c;
    transform: scale(1.1);
}

#scroll-to-top-btn:active {
    transform: scale(0.95);
}

@media (max-width: 767px) {
    #scroll-to-top-btn {
        width: 60px;
        height: 60px;
        bottom: 20px;
        right: 15px;
    }
}

header {
    position: relative;
    z-index: 100;
}

header .container {
    position: relative;
}

header img,
header svg,
header button,
header input {
    display: block;
}

#site-logo,
#site-logo-mobile {
    height: 3rem;
    width: auto;
}

#search-input,
#search-input-mobile {
    min-height: 40px;
}

#wishlist-count,
#cart-count,
#wishlist-count-mobile,
#cart-count-mobile {
    position: absolute;
    top: -0.5rem;
    right: -0.5rem;
    min-width: 1.25rem;
    min-height: 1.25rem;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.animate-fade-in {
    animation: fadeIn 0.3s ease;
}
</style>

<script src="https://cdn.tailwindcss.com"></script>

<style>
.page-content {
    opacity: 0;
    transition: opacity 0.2s ease-in;
}

.page-content.loaded {
    opacity: 1;
}

header {
    min-height: 64px;
}

header .container {
    min-height: inherit;
}

nav {
    min-height: 56px;
}

header, header *, nav, nav * {
    transform: translateZ(0);
    backface-visibility: hidden;
}

#search-input, #search-input-mobile,
#account-button, #account-button-mobile {
    opacity: 1;
    will-change: auto;
}

#wishlist-count, #cart-count,
#wishlist-count-mobile, #cart-count-mobile {
    position: absolute;
    top: -8px;
    right: -8px;
    transform: translateZ(0);
}

body {
    box-sizing: border-box;
}

.category-item:hover {
    background-color: #f3f4f6;
}

.product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.product-card {
    transition: all 0.3s ease;
}

#account-dropdown {
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

* {
    box-sizing: border-box;
}

html, body {
    overflow-x: hidden;
    max-width: 100%;
}

@media (max-width: 767px) {
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="tel"],
    input[type="number"],
    select,
    textarea {
        font-size: 16px !important;
    }
}
</style>

<!-- Organization Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "AutoPartsStore",
  "name": "Auto Adeal",
  "image": "https://autoadeal.com/static/logo.png",
  "url": "https://autoadeal.com",
  "telephone": "+355685526714",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Sarande",
    "addressCountry": "AL"
  },
  "priceRange": "$$",
  "openingHoursSpecification": {
    "@type": "OpeningHoursSpecification",
    "dayOfWeek": [
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ],
    "opens": "00:00",
    "closes": "23:59"
  }
}
</script>

<!-- WebSite Schema for Search Box -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Auto Adeal",
  "url": "https://autoadeal.com",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://autoadeal.com/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

{% block extra_head %}{% endblock %}

<style>@view-transition { navigation: auto; }</style>
</head>

<body class="h-full bg-white overflow-x-hidden">
<!-- Header -->
<header class="bg-black text-white py-3 md:py-4" style="min-height: 64px; position: relative; z-index: 100;">
<div class="container mx-auto px-4 md:px-6">
<!-- Mobile Layout -->
<div class="md:hidden">
  <!-- Top Row: Menu, Logo and Icons -->
  <div class="flex items-center justify-between mb-3" style="position: relative; z-index: 200;">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" onclick="toggleMobileMenu()" class="text-white mr-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
    
    <a href="/" class="flex items-center flex-1 h-8 hover:opacity-80 transition-opacity">
        <img id="site-logo-mobile" src="/static/logo.png" alt="Logo" class="h-full w-auto object-contain" style="display: none;">
        <span id="logo-text-mobile" class="text-xl font-bold text-white ml-1"></span>
    </a>
    
    <div class="flex items-center space-x-4">
      <!-- Account Dropdown -->
      <div class="relative">
        <button id="account-button-mobile" onclick="toggleAccountDropdown()" class="flex items-center text-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
           <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </button>
        
        <!-- Mobile Account Dropdown Menu -->
        <div id="account-dropdown-mobile" class="hidden absolute right-0 w-48 bg-white rounded-lg shadow-xl py-2" style="top: calc(100% + 8px); z-index: 300;">
          <!-- Logged Out Options -->
          <div id="logged-out-options-mobile">
            <button onclick="showLoginModal(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
              Hyr
            </button>
            <button onclick="showSignupModal(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
              Regjistrohu
            </button>
          </div>
          
          <!-- Logged In Options -->
          <div id="logged-in-options-mobile" class="hidden">
            <div class="px-4 py-2 border-b border-gray-200">
                <p id="dropdown-user-name-mobile" class="font-semibold text-black text-sm"></p>
                <p id="dropdown-user-email-mobile" class="text-xs text-gray-600 truncate"></p>
            </div>
            <button onclick="window.location.href='/order-tracking'" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
                Porositë e Mia
            </button>
            <button onclick="logout(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 transition-colors">
                Dil
            </button>
          </div>
        </div>
      </div>
      
      <!-- Wishlist -->
      <a href="/wishlist" class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
        <span id="wishlist-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
      </a>
      
      <!-- Cart -->
      <a href="/cart" class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
        </svg>
        <span id="cart-count-mobile" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
      </a>
    </div>
  </div>
  
  <!-- Bottom Row: Search -->
  <div class="flex" style="position: relative; z-index: 50;">
    <form action="/search" method="GET" class="flex flex-1">
      <input type="text" name="q" id="search-input-mobile" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none text-sm">
      <button type="submit" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-r-full transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>
    </form>
  </div>
</div>

<!-- Desktop Layout -->
<div class="hidden md:flex items-center justify-between">
  <!-- Logo -->
  <div class="flex items-center ml-8">
     <a href="/" class="flex items-center hover:opacity-80 transition-opacity select-none">
       <img id="site-logo" src="/static/logo.png" alt="Logo" class="h-12 md:h-14 w-auto max-w-[250px] object-contain pointer-events-none" style="display: none;" draggable="false">
       <span id="logo-text" class="text-2xl font-bold text-white"></span>
     </a>
   </div>
  
  <!-- Search Bar -->
   <div class="flex-1 max-w-md mx-8">
    <form action="/search" method="GET" class="flex">
      <input type="text" name="q" id="search-input" placeholder="Kërko..." class="flex-1 px-4 py-2 rounded-l-full text-black focus:outline-none">
      <button type="submit" class="relative bg-red-600 hover:bg-red-700 pl-6 pr-7 py-2 rounded-r-full transition-colors flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3" style="transform: translateX(-3px);">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35m1.6-5.65a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>
    </form>
   </div>
  
  <!-- Right Side Controls -->
   <div class="flex items-center space-x-6">
    <!-- Account Dropdown -->
    <div class="relative">
      <!-- Account Button -->
      <button id="account-button" onclick="toggleAccountDropdown()" class="flex items-center space-x-2 text-white hover:text-red-500 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <span id="account-label">Llogaria</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
      
      <!-- Dropdown Menu -->
      <div id="account-dropdown" class="hidden absolute right-0 mt-2 w-34 bg-white rounded-lg shadow-lg py-2 z-[110]">
        <!-- Logged Out Options -->
        <div id="logged-out-options">
          <button onclick="showLoginModal(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
            Hyr
          </button>
          <button onclick="showSignupModal(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
            Regjistrohu
          </button>
        </div>
        
        <!-- Logged In Options -->
        <div id="logged-in-options" class="hidden">
          <div class="px-4 py-2 border-b border-gray-200">
              <p id="dropdown-user-name" class="font-semibold text-black text-sm"></p>
              <p id="dropdown-user-email" class="text-xs text-gray-600 truncate"></p>
          </div>
          <button onclick="window.location.href='/order-tracking'" class="w-full text-left px-4 py-2 text-sm text-black hover:bg-gray-100 transition-colors">
              Porositë e Mia
          </button>
          <button onclick="logout(); closeAccountDropdown();" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 transition-colors">
              Dil
          </button>
        </div>
      </div>
    </div>

    <!-- Wishlist -->
    <a href="/wishlist" class="relative hover:text-red-500 transition-colors flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
      </svg>
      <span id="wishlist-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
    </a>

    <!-- Cart -->
    <a href="/cart" class="relative hover:text-red-500 transition-colors flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-1.2 6h12.8M10 19a1 1 0 11-2 0 1 1 0 012 0zm8 0a1 1 0 11-2 0 1 1 0 012 0z"/>
      </svg>
      <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
    </a>
    </div>
   </div>
  </div>
 </header>

<!-- Mobile Category Menu Overlay -->
<div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-[150] hidden" onclick="closeMobileMenu()"></div>
<div id="mobile-menu" class="fixed top-0 left-0 h-full w-80 bg-white z-[200] transform -translate-x-full transition-transform duration-300 overflow-y-auto">
  <div class="p-4 bg-black text-white flex items-center justify-between">
    <h3 class="font-bold text-lg">Kategoritë</h3>
    <button onclick="closeMobileMenu()" class="text-white">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
  <div id="mobile-categories-container" class="p-4">
    <!-- Categories will be loaded here -->
  </div>
</div>

<!-- Navigation Bar -->
<nav class="bg-white border-b border-gray-200 py-4" style="min-height: 56px; position: relative; z-index: 90;">
<div class="container mx-auto px-4 md:px-6">
  <div class="flex justify-center space-x-6 md:space-x-24 overflow-x-auto">
    <a href="/" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Kryefaqja</a>
    <a href="/special-offers" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Oferta</a>
    <a href="/brands" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Marka</a>
    <a href="/contact" class="text-black hover:text-red-600 font-medium transition-colors text-sm whitespace-nowrap">Na Kontaktoni</a>
  </div>
</div>
</nav>

<!-- Main Content -->
<div class="min-h-screen">
  {% block content %}{% endblock %}
</div>

<!-- Footer -->
<footer class="bg-black text-white py-8 md:py-12 mt-auto">
  <div class="container mx-auto px-4 md:px-6 max-w-7xl">
    <!-- Desktop Layout -->
    <div class="hidden md:flex flex-col items-center justify-center gap-8">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <img src="/static/logo.png" alt="Auto Adeal" class="h-20 w-auto" onerror="this.style.display='none'">
      </div>
      
      <!-- Links Grid -->
      <div class="grid grid-cols-3 gap-x-16 gap-y-4 text-center text-sm">
        <!-- Column 1 -->
        <div class="space-y-3">
          <a href="/privacy-policy" class="block hover:text-red-400 transition-colors">Privacy Policy</a>
          <a href="/terms-conditions" class="block hover:text-red-400 transition-colors">Terms & Conditions</a>
        </div>
        
        <!-- Column 2 -->
        <div class="space-y-3">
          <a href="/blog" class="block hover:text-red-400 transition-colors">Blog</a>
          <a href="/refund-policy" class="block hover:text-red-400 transition-colors">Refund & Shipping</a>
        </div>
        
        <!-- Column 3 -->
        <div class="space-y-3">
          <a href="/about" class="block hover:text-red-400 transition-colors">About Us</a>
          <a href="/contact" class="block hover:text-red-400 transition-colors">Contact Us</a>
        </div>
      </div>
    </div>
    
    <!-- Mobile Layout -->
    <div class="md:hidden">
      <div class="grid grid-cols-2 gap-x-8 gap-y-3 text-center text-sm">
        <a href="/privacy-policy" class="hover:text-red-400 transition-colors">Privacy Policy</a>
        <a href="/terms-conditions" class="hover:text-red-400 transition-colors">Terms & Conditions</a>
        <a href="/blog" class="hover:text-red-400 transition-colors">Blog</a>
        <a href="/refund-policy" class="hover:text-red-400 transition-colors">Refund & Shipping</a>
        <a href="/about" class="hover:text-red-400 transition-colors">About Us</a>
        <a href="/contact" class="hover:text-red-400 transition-colors">Contact Us</a>
      </div>
    </div>
    
    <!-- Copyright -->
    <div class="text-center mt-8 pt-4 border-t border-gray-700 text-xs text-gray-400">
      <p>&copy; 2025 Auto Adeal. Të gjitha të drejtat e rezervuara.</p>
    </div>
  </div>
</footer>

<!-- Login/Signup Modal -->
<div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[300]" style="display: none;">
<div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
  <div class="flex justify-between items-center mb-6">
   <h2 id="auth-title" class="text-2xl font-bold text-black">Hyr</h2>
   <button onclick="closeAuthModal()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
  </div>
  
  <!-- Login Form -->
  <form id="login-form" onsubmit="handleLogin(event)">
   <div class="space-y-4">
     <input type="email" id="login-email" placeholder="Email" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <input type="password" id="login-password" placeholder="Password" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors">Hyr</button>
   </div>
   <div class="mt-4 text-center">
     <button type="button" onclick="showForgotPassword()" class="text-red-600 hover:text-red-700 text-sm">Ke harruar fjalëkalimin?</button>
   </div>
   <div class="mt-4 text-center">
     <button type="button" onclick="showSignupForm()" class="text-gray-600 hover:text-gray-800">Nuk ke llogari? Regjistrohu</button>
   </div>
  </form>
  
  <!-- Signup Form -->
  <form id="signup-form" onsubmit="handleSignup(event)" style="display: none;">
   <div class="space-y-4">
     <input type="text" id="signup-name" placeholder="Emri" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <input type="text" id="signup-surname" placeholder="Mbiemri" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <input type="email" id="signup-email" placeholder="Email" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <input type="password" id="signup-password" placeholder="Password" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
     <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors">Regjistrohu</button>
   </div>
   <div class="mt-4 text-center">
     <button type="button" onclick="showLoginForm()" class="text-gray-600 hover:text-gray-800">Ke një llogari? Hyr</button>
   </div>
  </form>
  
  <!-- Forgot Password Form -->
  <form id="forgot-form" onsubmit="handleForgotPassword(event)" style="display: none;">
   <div class="space-y-4">
    <p class="text-gray-600 text-sm">Shkruaj emailin tënd për të marrë udhëzimet e rikuperimit të fjalëkalimit.</p>
    <input type="email" id="forgot-email" placeholder="Email" required class="w-full px-4 py-2 border border-gray-300 rounded text-black">
    <button type="submit" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors">Dërgo emailin e rikuperimit</button>
   </div>
   <div class="mt-4 text-center">
     <button type="button" onclick="showLoginForm()" class="text-gray-600 hover:text-gray-800">← Kthehu te hyrja</button>
   </div>
  </form>
</div>
</div>

<!-- Scroll to Top Button -->
<button id="scroll-to-top-btn" type="button" aria-label="Scroll to top">
  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"/>
  </svg>
</button>

<script>
// ============================================
// GLOBAL STATE & CONFIGURATION
// ============================================
let currentUser = null;
let cartItems = [];
let wishlistItems = [];
let categoriesData = [];

// ============================================
// AUTHENTICATION
// ============================================
function loadUserFromStorage() {
    const stored = localStorage.getItem('auto_adeal_user');
    const loginTime = localStorage.getItem('auto_adeal_login_time');
    
    if (stored && loginTime) {
        const daysSinceLogin = (Date.now() - parseInt(loginTime)) / (1000 * 60 * 60 * 24);
        
        if (daysSinceLogin < 730) {
            try {
                currentUser = JSON.parse(stored);
                updateAuthUI();
            } catch (e) {
                localStorage.removeItem('auto_adeal_user');
                localStorage.removeItem('auto_adeal_login_time');
            }
        } else {
            localStorage.removeItem('auto_adeal_user');
            localStorage.removeItem('auto_adeal_login_time');
        }
    }
}

function saveUserToStorage(user) {
    localStorage.setItem('auto_adeal_user', JSON.stringify(user));
    localStorage.setItem('auto_adeal_login_time', Date.now().toString());
}

function updateAuthUI() {
    const accountLabel = document.getElementById('account-label');
    const loggedOutOptions = document.getElementById('logged-out-options');
    const loggedInOptions = document.getElementById('logged-in-options');
    const dropdownUserName = document.getElementById('dropdown-user-name');
    const dropdownUserEmail = document.getElementById('dropdown-user-email');
    
    const loggedOutOptionsMobile = document.getElementById('logged-out-options-mobile');
    const loggedInOptionsMobile = document.getElementById('logged-in-options-mobile');
    const dropdownUserNameMobile = document.getElementById('dropdown-user-name-mobile');
    const dropdownUserEmailMobile = document.getElementById('dropdown-user-email-mobile');
    
    if (currentUser) {
        if (accountLabel) accountLabel.textContent = currentUser.name;
        if (loggedOutOptions) loggedOutOptions.classList.add('hidden');
        if (loggedInOptions) loggedInOptions.classList.remove('hidden');
        if (dropdownUserName) dropdownUserName.textContent = `${currentUser.name} ${currentUser.surname}`;
        if (dropdownUserEmail) dropdownUserEmail.textContent = currentUser.email;
        
        if (loggedOutOptionsMobile) loggedOutOptionsMobile.classList.add('hidden');
        if (loggedInOptionsMobile) loggedInOptionsMobile.classList.remove('hidden');
        if (dropdownUserNameMobile) dropdownUserNameMobile.textContent = `${currentUser.name} ${currentUser.surname}`;
        if (dropdownUserEmailMobile) dropdownUserEmailMobile.textContent = currentUser.email;
    } else {
        if (accountLabel) accountLabel.textContent = 'Llogaria';
        if (loggedOutOptions) loggedOutOptions.classList.remove('hidden');
        if (loggedInOptions) loggedInOptions.classList.add('hidden');
        
        if (loggedOutOptionsMobile) loggedOutOptionsMobile.classList.remove('hidden');
        if (loggedInOptionsMobile) loggedInOptionsMobile.classList.add('hidden');
    }
}

function showLoginModal() {
    document.getElementById('auth-modal').style.display = 'flex';
    document.getElementById('auth-title').textContent = 'Hyr';
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('signup-form').style.display = 'none';
    document.getElementById('forgot-form').style.display = 'none';
}

function showSignupModal() {
    document.getElementById('auth-modal').style.display = 'flex';
    document.getElementById('auth-title').textContent = 'Regjistrohu';
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('signup-form').style.display = 'block';
    document.getElementById('forgot-form').style.display = 'none';
}

function closeAuthModal() {
    document.getElementById('auth-modal').style.display = 'none';
    document.getElementById('login-form').reset();
    document.getElementById('signup-form').reset();
    document.getElementById('forgot-form').reset();
}

function showLoginForm() {
    showLoginModal();
}

function showSignupForm() {
    showSignupModal();
}

function showForgotPassword() {
    document.getElementById('auth-title').textContent = 'Rivendos fjalëkalimin';
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('signup-form').style.display = 'none';
    document.getElementById('forgot-form').style.display = 'block';
}

async function handleLogin(event) {
    event.preventDefault();
    
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            currentUser = data.user;
            saveUserToStorage(data.user);
            updateAuthUI();
            closeAuthModal();
            showNotification('Hyra u krye me sukses!', 'success');
        } else {
            showNotification(data.error || 'Hyra dështoi', 'error');
        }
    } catch (error) {
        console.error('Login error:', error);
        showNotification('Hyra dështoi. Provoni përsëri.', 'error');
    }
}

async function handleSignup(event) {
    event.preventDefault();
    
    const name = document.getElementById('signup-name').value;
    const surname = document.getElementById('signup-surname').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    
    try {
        const response = await fetch('/api/auth/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, surname, email, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            currentUser = data.user;
            saveUserToStorage(data.user);
            updateAuthUI();
            closeAuthModal();
            showNotification('Llogaria u krijua me sukses!', 'success');
        } else {
            showNotification(data.error || 'Regjistrimi dështoi', 'error');
        }
    } catch (error) {
        console.error('Signup error:', error);
        showNotification('Regjistrimi dështoi. Provoni përsëri.', 'error');
    }
}

async function handleForgotPassword(event) {
    event.preventDefault();
    
    const email = document.getElementById('forgot-email').value;
    
    try {
        const response = await fetch('/api/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            showNotification('Link për rikthimin e fjalëkalimit u dërgua në email', 'success');
            closeAuthModal();
        } else {
            showNotification(data.error || 'Kerkesa deshtoi', 'error');
        }
    } catch (error) {
        console.error('Forgot password error:', error);
        showNotification('Kerkesa deshtoi', 'error');
    }
}

function logout() {
    currentUser = null;
    localStorage.removeItem('auto_adeal_user');
    localStorage.removeItem('auto_adeal_login_time');
    updateAuthUI();
    showNotification('Dalja u krye me sukses', 'success');
    window.location.href = '/';
}

function toggleAccountDropdown() {
    const dropdown = document.getElementById('account-dropdown');
    const dropdownMobile = document.getElementById('account-dropdown-mobile');
    
    if (dropdown) dropdown.classList.toggle('hidden');
    if (dropdownMobile) dropdownMobile.classList.toggle('hidden');
}

function closeAccountDropdown() {
    const dropdown = document.getElementById('account-dropdown');
    const dropdownMobile = document.getElementById('account-dropdown-mobile');
    
    if (dropdown) dropdown.classList.add('hidden');
    if (dropdownMobile) dropdownMobile.classList.add('hidden');
}

document.addEventListener('click', function(event) {
    const accountButton = document.getElementById('account-button');
    const accountButtonMobile = document.getElementById('account-button-mobile');
    const dropdown = document.getElementById('account-dropdown');
    const dropdownMobile = document.getElementById('account-dropdown-mobile');
    
    const clickedAccountButton = accountButton && accountButton.contains(event.target);
    const clickedAccountButtonMobile = accountButtonMobile && accountButtonMobile.contains(event.target);
    const clickedDropdown = dropdown && dropdown.contains(event.target);
    const clickedDropdownMobile = dropdownMobile && dropdownMobile.contains(event.target);
    
    if (!clickedAccountButton && !clickedAccountButtonMobile && !clickedDropdown && !clickedDropdownMobile) {
        if (dropdown) dropdown.classList.add('hidden');
        if (dropdownMobile) dropdownMobile.classList.add('hidden');
    }
});

// ============================================
// CART FUNCTIONALITY
// ============================================
function loadCartFromStorage() {
    try {
        const stored = localStorage.getItem('auto_adeal_cart');
        if (stored) {
            cartItems = JSON.parse(stored);
        } else {
            cartItems = [];
        }
    } catch (e) {
        console.error('Error loading cart:', e);
        cartItems = [];
    }
}

function saveCartToStorage() {
    localStorage.setItem('auto_adeal_cart', JSON.stringify(cartItems));
}

function addToCart(productId, productName, productPrice, productImage, isSoldOut = false) {
    if (isSoldOut) {
        showNotification('Ky Produkt Eshte Shitur', 'error');
        return;
    }
    
    const existingItem = cartItems.find(item => item.productId === productId);
    
    if (existingItem) {
        existingItem.quantity += 1;
        showNotification('U Ndryshua Sasia ne Shporte', 'success');
    } else {
        cartItems.push({
            productId,
            productName,
            productPrice,
            productImage,
            quantity: 1
        });
        showNotification('U Shtua ne Shporte!', 'success');
    }
    
    saveCartToStorage();
    updateCartCount();
}

function updateCartCount() {
    const count = cartItems.length;
    const cartCountEl = document.getElementById('cart-count');
    const cartCountMobileEl = document.getElementById('cart-count-mobile');
    
    if (cartCountEl) cartCountEl.textContent = count;
    if (cartCountMobileEl) cartCountMobileEl.textContent = count;
}

// ============================================
// WISHLIST FUNCTIONALITY
// ============================================
function loadWishlistFromStorage() {
    try {
        const stored = localStorage.getItem('auto_adeal_wishlist');
        if (stored) {
            wishlistItems = JSON.parse(stored);
        } else {
            wishlistItems = [];
        }
    } catch (e) {
        console.error('Error loading wishlist:', e);
        wishlistItems = [];
    }
}

function saveWishlistToStorage() {
    localStorage.setItem('auto_adeal_wishlist', JSON.stringify(wishlistItems));
}

function toggleWishlist(productId, productName, productPrice, productImage, isSoldOut = false) {
    if (isSoldOut) {
        showNotification('Ky produkt eshte shitur', 'error');
        return;
    }
    
    const existingIndex = wishlistItems.findIndex(item => item.productId === productId);
    
    if (existingIndex !== -1) {
        wishlistItems.splice(existingIndex, 1);
        showNotification('U hoq nga Lista', 'success');
    } else {
        wishlistItems.push({
            productId,
            productName,
            productPrice,
            productImage
        });
        showNotification('U Shtua ne Liste!', 'success');
    }
    
    saveWishlistToStorage();
    updateWishlistCount();
}

function updateWishlistCount() {
    const count = wishlistItems.length;
    const wishlistCountEl = document.getElementById('wishlist-count');
    const wishlistCountMobileEl = document.getElementById('wishlist-count-mobile');
    
    if (wishlistCountEl) wishlistCountEl.textContent = count;
    if (wishlistCountMobileEl) wishlistCountMobileEl.textContent = count;
}

// ============================================
// MOBILE MENU
// ============================================
function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-menu-overlay');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.toggle('-translate-x-full');
    overlay.classList.toggle('hidden');
    
    if (menu.classList.contains('-translate-x-full')) {
        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>`;
    } else {
        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>`;
        renderMobileCategories();
    }
}

function closeMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-menu-overlay');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
    btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>`;
}

async function loadCategories() {
    try {
        const response = await fetch('/api/categories');
        categoriesData = await response.json();
    } catch (error) {
        console.error('Failed to load categories:', error);
    }
}

function renderMobileCategories() {
    const container = document.getElementById('mobile-categories-container');
    if (!container) return;
    
    container.innerHTML = '';

    for (const category of categoriesData) {
        const catDiv = document.createElement('div');
        catDiv.classList.add('mb-4', 'border-b', 'border-gray-200', 'pb-4');

        const catTitle = document.createElement('h4');
        catTitle.classList.add('font-semibold', 'text-black', 'mb-2', 'cursor-pointer', 
                               'hover:text-red-600', 'transition-colors', 'text-base');
        catTitle.textContent = category.name;
        catTitle.onclick = () => toggleMobileSubcategories(category.id);
        catDiv.appendChild(catTitle);

        const subList = document.createElement('div');
        subList.classList.add('space-y-1', 'ml-3', 'hidden');
        subList.id = `mobile-subcats-${category.id}`;
        
        for (const sub of category.subcategories) {
            const btn = document.createElement('a');
            btn.href = `/subcategory/${sub.id}/${encodeURIComponent(sub.name)}`;
            btn.textContent = sub.name;
            btn.classList.add('block', 'w-full', 'text-left', 'px-3', 'py-2', 'rounded', 
                             'text-black', 'hover:bg-gray-200', 'transition-colors', 'text-sm');
            btn.onclick = () => closeMobileMenu();
            subList.appendChild(btn);
        }
        
        const allBtn = document.createElement('a');
        allBtn.href = `/category/${category.id}/${encodeURIComponent(category.name)}`;
        allBtn.textContent = 'Te gjitha';
        allBtn.classList.add('block', 'w-full', 'text-left', 'px-3', 'py-2', 'rounded', 
                             'text-black', 'hover:bg-gray-200', 'transition-colors', 'text-sm', 'font-medium');
        allBtn.onclick = () => closeMobileMenu();
        subList.appendChild(allBtn);

        catDiv.appendChild(subList);
        container.appendChild(catDiv);
    }
}

function toggleMobileSubcategories(categoryId) {
    const subDiv = document.getElementById(`mobile-subcats-${categoryId}`);
    if (subDiv) {
        subDiv.classList.toggle('hidden');
    }
}

// ============================================
// SITE SETTINGS
// ============================================
async function loadSiteSettings() {
    try {
        const response = await fetch('/api/settings');
        const settings = await response.json();
        
        if (settings.logo_url) {
            const logoDesktop = document.getElementById('site-logo');
            const logoMobile = document.getElementById('site-logo-mobile');
            const logoTextDesktop = document.getElementById('logo-text');
            const logoTextMobile = document.getElementById('logo-text-mobile');
            
            if (logoDesktop && logoMobile) {
                logoDesktop.src = settings.logo_url;
                logoMobile.src = settings.logo_url;
                logoDesktop.style.display = 'block';
                logoMobile.style.display = 'block';
                
                if (logoTextDesktop) logoTextDesktop.style.display = 'none';
                if (logoTextMobile) logoTextMobile.style.display = 'none';
            }
        }
        
        if (settings.site_name) {
            const logoTextDesktop = document.getElementById('logo-text');
            const logoTextMobile = document.getElementById('logo-text-mobile');
            if (logoTextDesktop) logoTextDesktop.textContent = settings.site_name;
            if (logoTextMobile) logoTextMobile.textContent = settings.site_name;
        }
    } catch (error) {
        console.error('Failed to load site settings:', error);
    }
}

// ============================================
// UTILITY FUNCTIONS
// ============================================
function showNotification(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ============================================
// SCROLL TO TOP BUTTON
// ============================================
(function() {
    function init() {
        const scrollBtn = document.getElementById('scroll-to-top-btn');
        
        if (!scrollBtn) return;
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollBtn.classList.add('visible');
            } else {
                scrollBtn.classList.remove('visible');
            }
        }, { passive: true });
        
        scrollBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', function() {
    loadUserFromStorage();
    loadCartFromStorage();
    loadWishlistFromStorage();
    updateCartCount();
    updateWishlistCount();
    loadCategories();
    loadSiteSettings();
});
</script>

{% block extra_js %}{% endblock %}
</body>
</html>